{"uid":"e7921f7fb2f2ae4f","name":"Send two GPD messages with timestamps T1 and T1-T2","fullName":"tests.test_producer_gpd_message#test_send_producer_gpd_messages_with_timestamps","historyId":"0ded6b2d942d277aea90826219f9cec9","time":{"start":1760513107090,"stop":1760513117977,"duration":10887},"status":"failed","statusMessage":"Failed: Failed to send first message after 3 attempts","statusTrace":"@allure.feature('GPD Message')\n    @allure.story('Send GPD message to queue')\n    @allure.title('Send two GPD messages with timestamps T1 and T1-T2')\n    @pytest.mark.producer_gpd_message\n    @pytest.mark.happy_path\n    def test_send_producer_gpd_messages_with_timestamps():\n        debtor_fc = activate_new_debtor()\n    \n        common_iuv = generate_iuv()\n        common_nav = f\"3{common_iuv}\"\n    \n        t1 = int(datetime.now(timezone.utc).timestamp() * 1000)\n    \n        payload_t1 = generate_producer_gpd_message_payload(\n            operation='CREATE',\n            ec_tax_code='80015010723',\n            amount=30000,\n            status='VALID',\n            overrides={\n                'timestamp': t1,\n                'iuv': common_iuv,\n                'nav': common_nav,\n                'debtor_tax_code': debtor_fc\n            }\n        )\n    \n>       response_t1 = send_message_with_retry(payload_t1, 'first')\n\nfunctional-tests/tests/test_producer_gpd_message.py:50: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\npayload = {'amount': 30000, 'debtor_tax_code': 'RRCMRH62R11X000R', 'description': 'lVQyiRiZyBx8QiDoFIwTWjZVzPEkUM4oXnaYjhMFXG0Fbze YJOGjXw', 'due_date': 1763105107904, ...}\nmessage_label = 'first', max_retries = 3, retry_delay = 5\n\n    def send_message_with_retry(payload, message_label='', max_retries=3, retry_delay=5):\n        \"\"\"Helper function to send a GPD message with retry mechanism.\n    \n        Args:\n            payload (dict): The message payload to send\n            message_label (str): A label for the message for logging purposes\n            max_retries (int): Maximum number of retry attempts\n            retry_delay (int): Seconds to wait between retry attempts\n    \n        Returns:\n            requests.Response: The API response if successful\n    \n        Raises:\n            AssertionError: If all retries fail\n        \"\"\"\n        for attempt in range(max_retries):\n            try:\n                print(f\"Sending {message_label} message (attempt {attempt+1}/{max_retries})...\")\n                response = send_producer_gpd_message(payload)\n    \n                if response.status_code == 200:\n                    print(f\"{message_label} message sent successfully\")\n                    return response\n                elif 'RequestTimedOutError' in response.text:\n                    print(f\"Timeout detected: {response.text}\")\n                    if attempt < max_retries - 1:\n                        print(f\"Waiting {retry_delay} seconds before retrying...\")\n                        time.sleep(retry_delay)\n                    continue\n                else:\n                    assert response.status_code == 200, f\"Failed to send {message_label} message: {response.text}\"\n            except Exception as e:\n                if attempt < max_retries - 1:\n                    print(f\"Error sending: {str(e)}. Retrying in {retry_delay} seconds...\")\n                    time.sleep(retry_delay)\n    \n>       pytest.fail(f\"Failed to send {message_label} message after {max_retries} attempts\")\nE       Failed: Failed to send first message after 3 attempts\n\nutils/producer_gpd_utils.py:50: Failed","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"_session_faker","time":{"start":1760512946085,"stop":1760512946145,"duration":60},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"status":"failed","statusMessage":"Failed: Failed to send first message after 3 attempts","statusTrace":"@allure.feature('GPD Message')\n    @allure.story('Send GPD message to queue')\n    @allure.title('Send two GPD messages with timestamps T1 and T1-T2')\n    @pytest.mark.producer_gpd_message\n    @pytest.mark.happy_path\n    def test_send_producer_gpd_messages_with_timestamps():\n        debtor_fc = activate_new_debtor()\n    \n        common_iuv = generate_iuv()\n        common_nav = f\"3{common_iuv}\"\n    \n        t1 = int(datetime.now(timezone.utc).timestamp() * 1000)\n    \n        payload_t1 = generate_producer_gpd_message_payload(\n            operation='CREATE',\n            ec_tax_code='80015010723',\n            amount=30000,\n            status='VALID',\n            overrides={\n                'timestamp': t1,\n                'iuv': common_iuv,\n                'nav': common_nav,\n                'debtor_tax_code': debtor_fc\n            }\n        )\n    \n>       response_t1 = send_message_with_retry(payload_t1, 'first')\n\nfunctional-tests/tests/test_producer_gpd_message.py:50: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\npayload = {'amount': 30000, 'debtor_tax_code': 'RRCMRH62R11X000R', 'description': 'lVQyiRiZyBx8QiDoFIwTWjZVzPEkUM4oXnaYjhMFXG0Fbze YJOGjXw', 'due_date': 1763105107904, ...}\nmessage_label = 'first', max_retries = 3, retry_delay = 5\n\n    def send_message_with_retry(payload, message_label='', max_retries=3, retry_delay=5):\n        \"\"\"Helper function to send a GPD message with retry mechanism.\n    \n        Args:\n            payload (dict): The message payload to send\n            message_label (str): A label for the message for logging purposes\n            max_retries (int): Maximum number of retry attempts\n            retry_delay (int): Seconds to wait between retry attempts\n    \n        Returns:\n            requests.Response: The API response if successful\n    \n        Raises:\n            AssertionError: If all retries fail\n        \"\"\"\n        for attempt in range(max_retries):\n            try:\n                print(f\"Sending {message_label} message (attempt {attempt+1}/{max_retries})...\")\n                response = send_producer_gpd_message(payload)\n    \n                if response.status_code == 200:\n                    print(f\"{message_label} message sent successfully\")\n                    return response\n                elif 'RequestTimedOutError' in response.text:\n                    print(f\"Timeout detected: {response.text}\")\n                    if attempt < max_retries - 1:\n                        print(f\"Waiting {retry_delay} seconds before retrying...\")\n                        time.sleep(retry_delay)\n                    continue\n                else:\n                    assert response.status_code == 200, f\"Failed to send {message_label} message: {response.text}\"\n            except Exception as e:\n                if attempt < max_retries - 1:\n                    print(f\"Error sending: {str(e)}. Retrying in {retry_delay} seconds...\")\n                    time.sleep(retry_delay)\n    \n>       pytest.fail(f\"Failed to send {message_label} message after {max_retries} attempts\")\nE       Failed: Failed to send first message after 3 attempts\n\nutils/producer_gpd_utils.py:50: Failed","steps":[],"attachments":[{"uid":"f2314d696fcc9ab8","name":"stdout","source":"f2314d696fcc9ab8.txt","type":"text/plain","size":920}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},"afterStages":[],"labels":[{"name":"feature","value":"GPD Message"},{"name":"story","value":"Send GPD message to queue"},{"name":"tag","value":"happy_path"},{"name":"tag","value":"producer_gpd_message"},{"name":"parentSuite","value":"tests"},{"name":"suite","value":"test_producer_gpd_message"},{"name":"host","value":"runnervmwhb2z"},{"name":"thread","value":"2578-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_producer_gpd_message"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":16,"broken":4,"skipped":0,"passed":0,"unknown":0,"total":20},"items":[{"uid":"6dac047f457a1e77","reportUrl":"https://pagopa.github.io/rtp-platform-qa/functional/568//#testresult/6dac047f457a1e77","status":"failed","statusDetails":"Failed: Failed to send first message after 3 attempts","time":{"start":1760434964796,"stop":1760434976025,"duration":11229}},{"uid":"3ca06ac4ee356d75","reportUrl":"https://pagopa.github.io/rtp-platform-qa/functional/567//#testresult/3ca06ac4ee356d75","status":"failed","statusDetails":"Failed: Failed to send first message after 3 attempts","time":{"start":1760427017362,"stop":1760427028316,"duration":10954}},{"uid":"51e0e85df16b5a4a","reportUrl":"https://pagopa.github.io/rtp-platform-qa/functional/566//#testresult/51e0e85df16b5a4a","status":"failed","statusDetails":"Failed: Failed to send first message after 3 attempts","time":{"start":1760340645538,"stop":1760340656778,"duration":11240}},{"uid":"119b588293454dfd","reportUrl":"https://pagopa.github.io/rtp-platform-qa/functional/565//#testresult/119b588293454dfd","status":"failed","statusDetails":"Failed: Failed to send first message after 3 attempts","time":{"start":1760254032856,"stop":1760254044142,"duration":11286}},{"uid":"e78f19617238a468","reportUrl":"https://pagopa.github.io/rtp-platform-qa/functional/564//#testresult/e78f19617238a468","status":"failed","statusDetails":"Failed: Failed to send first message after 3 attempts","time":{"start":1760167596444,"stop":1760167607187,"duration":10743}},{"uid":"29c63c5655ec3de2","reportUrl":"https://pagopa.github.io/rtp-platform-qa/functional/563//#testresult/29c63c5655ec3de2","status":"failed","statusDetails":"Failed: Failed to send first message after 3 attempts","time":{"start":1760081310276,"stop":1760081321205,"duration":10929}},{"uid":"d2632ac145d995f9","reportUrl":"https://pagopa.github.io/rtp-platform-qa/functional/562//#testresult/d2632ac145d995f9","status":"failed","statusDetails":"Failed: Failed to send first message after 3 attempts","time":{"start":1759994941081,"stop":1759994952042,"duration":10961}},{"uid":"b48a203e14dc09d1","reportUrl":"https://pagopa.github.io/rtp-platform-qa/functional/561//#testresult/b48a203e14dc09d1","status":"failed","statusDetails":"Failed: Failed to send first message after 3 attempts","time":{"start":1759929472276,"stop":1759929483282,"duration":11006}},{"uid":"4cb918d9bafb372c","reportUrl":"https://pagopa.github.io/rtp-platform-qa/functional/560//#testresult/4cb918d9bafb372c","status":"failed","statusDetails":"Failed: Failed to send first message after 3 attempts","time":{"start":1759921267431,"stop":1759921278179,"duration":10748}},{"uid":"4890314f56667e70","reportUrl":"https://pagopa.github.io/rtp-platform-qa/functional/559//#testresult/4890314f56667e70","status":"failed","statusDetails":"Failed: Failed to send first message after 3 attempts","time":{"start":1759920033857,"stop":1759920044656,"duration":10799}},{"uid":"f6be602b50bce9d0","reportUrl":"https://pagopa.github.io/rtp-platform-qa/functional/558//#testresult/f6be602b50bce9d0","status":"broken","statusDetails":"requests.exceptions.HTTPError: 502 Server Error: Bad Gateway for url: https://api-mcshared.uat.cstar.pagopa.it/auth/token","time":{"start":1759908349463,"stop":1759908349982,"duration":519}},{"uid":"7d7112b638452546","reportUrl":"https://pagopa.github.io/rtp-platform-qa/functional/557//#testresult/7d7112b638452546","status":"failed","statusDetails":"Failed: Failed to send first message after 3 attempts","time":{"start":1759822126823,"stop":1759822137680,"duration":10857}},{"uid":"8f1a5f9ac450edf3","reportUrl":"https://pagopa.github.io/rtp-platform-qa/functional/556//#testresult/8f1a5f9ac450edf3","status":"failed","statusDetails":"Failed: Failed to send first message after 3 attempts","time":{"start":1759735710653,"stop":1759735721887,"duration":11234}},{"uid":"f66c6d60141a4fc1","reportUrl":"https://pagopa.github.io/rtp-platform-qa/functional/555//#testresult/f66c6d60141a4fc1","status":"failed","statusDetails":"Failed: Failed to send first message after 3 attempts","time":{"start":1759650005769,"stop":1759650016559,"duration":10790}},{"uid":"ddf12f6a0e14457a","reportUrl":"https://pagopa.github.io/rtp-platform-qa/functional/554//#testresult/ddf12f6a0e14457a","status":"failed","statusDetails":"Failed: Failed to send first message after 3 attempts","time":{"start":1759563668610,"stop":1759563679896,"duration":11286}},{"uid":"6031978ee45268d8","reportUrl":"https://pagopa.github.io/rtp-platform-qa/functional/553//#testresult/6031978ee45268d8","status":"failed","statusDetails":"Failed: Failed to send first message after 3 attempts","time":{"start":1759484832974,"stop":1759484844253,"duration":11279}},{"uid":"e29ab548280085c1","reportUrl":"https://pagopa.github.io/rtp-platform-qa/functional/552//#testresult/e29ab548280085c1","status":"broken","statusDetails":"requests.exceptions.ConnectionError: HTTPConnectionPool(host='qa.internal.uat.cstar.pagopa.it', port=80): Max retries exceeded with url: /send/gpd/message (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x7f818d353b10>: Failed to resolve 'qa.internal.uat.cstar.pagopa.it' ([Errno -2] Name or service not known)\"))","time":{"start":1759476825310,"stop":1759476835371,"duration":10061}},{"uid":"e4cf436b91e333fa","reportUrl":"https://pagopa.github.io/rtp-platform-qa/functional/551//#testresult/e4cf436b91e333fa","status":"broken","statusDetails":"requests.exceptions.ConnectionError: HTTPConnectionPool(host='qa.internal.uat.cstar.pagopa.it', port=80): Max retries exceeded with url: /send/gpd/message (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x7f93b9230550>: Failed to resolve 'qa.internal.uat.cstar.pagopa.it' ([Errno -2] Name or service not known)\"))","time":{"start":1759390813342,"stop":1759390823382,"duration":10040}},{"uid":"cb699d28043baae3","reportUrl":"https://pagopa.github.io/rtp-platform-qa/functional/550//#testresult/cb699d28043baae3","status":"broken","statusDetails":"requests.exceptions.ConnectionError: HTTPConnectionPool(host='qa.internal.uat.cstar.pagopa.it', port=80): Max retries exceeded with url: /send/gpd/message (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x7f279ccbae90>: Failed to resolve 'qa.internal.uat.cstar.pagopa.it' ([Errno -2] Name or service not known)\"))","time":{"start":1759316214017,"stop":1759316224045,"duration":10028}}]},"tags":["producer_gpd_message","happy_path"]},"source":"e7921f7fb2f2ae4f.json","parameterValues":[]}